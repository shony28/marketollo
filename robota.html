<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    /* –í–∞—à—ñ —Å—Ç–∏–ª—ñ –∫–æ–ø—ñ—é—é—Ç—å—Å—è —Å—é–¥–∏ –±–µ–∑ –∑–º—ñ–Ω... */
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 10px; background: #f4f4f9; margin: 0; }
    #loginContainer { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; text-align: center; }
    #appContainer { display: none; }
    h2 { text-align: center; color: #333; margin: 20px 0; }
    .filter-container { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; font-size: 0.9em; color: #555; }
    .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
    .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #2ecc71; }
    input:checked + .slider:before { transform: translateX(20px); }
    .hidden-task { display: none !important; }
    #userInfo { text-align: center; margin: 20px 0; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 600px; margin: 20px auto; }
    #userInfo button { margin-top: 10px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; }
    #taskList { max-width: 600px; margin: 0 auto; }
    .task-card { background: white; padding: 16px; margin-bottom: 12px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 12px; }
    @media (min-width: 480px) { .task-card { flex-direction: row; justify-content: space-between; align-items: center; } }
    .task-info { flex: 1; }
    .task-info strong { font-size: 1.1em; color: #2c3e50; display: block; margin-bottom: 4px; }
    .task-info small { color: #7f8c8d; font-size: 0.9em; }
    .task-controls { display: flex; align-items: center; justify-content: space-between; gap: 8px; width: 100%; }
    @media (min-width: 480px) { .task-controls { width: auto; } }
    select { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; font-size: 16px; }
    button { padding: 10px 18px; font-size: 16px; font-weight: bold; cursor: pointer; background: #2b2b2b; color: white; border: none; border-radius: 8px; min-width: 60px; transition: background 0.2s; }
    button:active { background: #555; }
    .status-badge { display: inline-block; margin-bottom: 8px; font-size: 0.75em; padding: 4px 12px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px; }
    .status-badge.status-–Ω–æ–≤–µ { background-color: #3498db; color: white; }
    .status-badge.status-–ø—Ä–æ—Ü–µ—Å—ñ { background-color: #f7cb00; color: #2c3e50; }
    .status-badge.status-–ø–∞—É–∑–∞ { background-color: #f78600; color: white; }
    .status-badge.status-–≤–∏–∫–æ–Ω–∞–Ω–æ { background-color: #2ecc71; color: white; }
    #loader { text-align: center; padding: 20px; }
    /* –°—Ç–∏–ª—ñ –¥–ª—è —Ñ–æ—Ä–º–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è */
    #createForm { 
      display: none; 
      background: white; 
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
      max-width: 560px; 
      margin: 20px auto; 
    }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
    .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    .btn-primary { background: #2ecc71; width: 100%; margin-top: 10px; }
    .btn-cancel { background: #95a5a6; width: 100%; margin-top: 5px; }
    .header-actions { display: flex; justify-content: space-between; align-items: center; max-width: 600px; margin: 0 auto; padding: 0 10px; }
  </style>
</head>
<body>

  <div id="loginContainer">
    <h1>üìã –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏</h1>
    <p style="color: #666; margin-bottom: 30px;">–£–≤—ñ–π–¥—ñ—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Google –∞–∫–∞—É–Ω—Ç–∞</p>
    <div id="g_id_onload"
      data-client_id="738653025538-325fmpgrd37ji1leusus42gacqaja040.apps.googleusercontent.com"
      data-callback="handleLogin"
      data-auto_prompt="false">
    </div>
    <div class="g_id_signin"></div>
  </div>

  <div id="appContainer">
    <div id="userInfo"></div>
    <div class="header-actions">
      <h2>üìã –ú–æ—ó –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
      <button onclick="toggleCreateForm(true)" style="background: #2ecc71;">+ –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
    </div>

    <div id="createForm">
      <h3 style="margin-top:0">–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h3>
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞ –∑–∞–≤–¥–∞–Ω–Ω—è (col_TITLE)</label>
        <input type="text" id="newTitle" placeholder="–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏?">
      </div>
      <div class="form-group">
        <label>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å (col_WORKER)</label>
        <input type="text" id="newWorker" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è">
      </div>
        <div class="form-group">
          <label>–î–∞—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (DD.MM.YYYY)</label>
          <input type="text" 
                 id="newDate" 
                 placeholder="13.02.2026" 
                 oninput="formatDateInput(this)" 
                 maxlength="10">
        </div>
      <button class="btn-primary" id="saveTaskBtn" onclick="submitNewTask()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
      <button class="btn-cancel" onclick="toggleCreateForm(false)">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>

    <div class="filter-container" style="flex-wrap: wrap; gap: 15px;">
      <div>
        <span>–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</span>
          <select id="sortOrder" onchange="saveSortSettings(); loadTasks();" style="padding: 5px; font-size: 14px; border-radius: 5px;">
            <option value="default">–Ø–∫ —É —Ç–∞–±–ª–∏—Ü—ñ (–∑–∞ –ø–æ—Ä—è–¥–∫–æ–º)</option>
            <option value="priority">–ó–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º (–î–∞—Ç–∞)</option>
            <option value="status">–ó–∞ —Å—Ç–∞—Ç—É—Å–æ–º</option>
          </select>
      </div>
      
      <div style="display: flex; align-items: center; gap: 8px;">
        <span>–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ</span>
        <label class="switch">
          <input type="checkbox" id="hideDoneToggle" onchange="applyFilter()">
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <div id="loader">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å...</div>
    <div id="taskList"></div>
  </div>

  <script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ö–û–õ–û–ù–û–ö (–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ TEST.js) ---
    // –í JS –º–∞—Å–∏–≤–∞—Ö —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ 0, —Ç–æ–º—É –≤—ñ–¥–Ω—ñ–º–∞—î–º–æ 1 –≤—ñ–¥ –Ω–æ–º–µ—Ä—ñ–≤ –∫–æ–ª–æ–Ω–æ–∫ —Ç–∞–±–ª–∏—Ü—ñ
    const col_TITLE           = 2 - 1;   // B
    const col_WORKER          = 6 - 1;   // F
    const col_DATE            = 7 - 1;   // G
    const col_STATUS          = 8 - 1;   // H
    const col_TASK_EMAIL      = 24 - 1;  // X

    const API_URL = "https://script.google.com/macros/s/AKfycbx9jMxg5AjebLHF0z5NWJwYPISXejVYL2_uJ0mmVqFmhnM_9MAUoLaRjZQK6jSAbwfo/exec";
    let currentUserEmail = null;

    // –†–µ—à—Ç–∞ –ª–æ–≥—ñ–∫–∏ handleLogin, logout, checkSavedSession –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è...
    function handleLogin(response) {
        fetch(API_URL + "?action=login", {
          method: "POST",
          mode: "cors",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify({ token: response.credential })
        })
        .then(r => r.json())
        .then(user => {
          if (user.status === 'success') {
            currentUserEmail = user.email;
            localStorage.setItem('userEmail', user.email);
            localStorage.setItem('userName', user.name);
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("appContainer").style.display = "block";
            document.getElementById("userInfo").innerHTML = `
              <strong>–ü—Ä–∏–≤—ñ—Ç, ${user.name}!</strong><br>
              <small>${user.email}</small><br>
              <button onclick="logout()">–í–∏–π—Ç–∏</button>
            `;
            loadTasks();
          } else {
            alert("–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó: " + user.message);
          }
        })
        .catch(err => {
          console.error("–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ:", err);
          alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞");
        });
      }

    function logout() {
        currentUserEmail = null;
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userName');
        document.getElementById("loginContainer").style.display = "flex";
        document.getElementById("appContainer").style.display = "none";
        document.getElementById("taskList").innerHTML = "";
    }

    function checkSavedSession() {
        const savedEmail = localStorage.getItem('userEmail');
        const savedName = localStorage.getItem('userName');
        const savedFilter = localStorage.getItem('hideDoneSettings');
        if (savedFilter !== null) document.getElementById('hideDoneToggle').checked = (savedFilter === 'true');
        const savedSort = localStorage.getItem('taskSortMode');
        if (savedSort !== null) document.getElementById('sortOrder').value = savedSort;
        
        if (savedEmail && savedName) {
            currentUserEmail = savedEmail;
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("appContainer").style.display = "block";
            document.getElementById("userInfo").innerHTML = `
                <strong>–ü—Ä–∏–≤—ñ—Ç, ${savedName}!</strong><br>
                <small>${savedEmail}</small><br>
                <button onclick="logout()">–í–∏–π—Ç–∏</button>
            `;
            loadTasks();
        }
    }

    window.addEventListener('DOMContentLoaded', checkSavedSession);

    function applyFilter() {
      const hideDone = document.getElementById('hideDoneToggle').checked;
      localStorage.setItem('hideDoneSettings', hideDone);
      document.querySelectorAll('.task-card').forEach(card => {
        const status = card.getAttribute('data-status');
        (hideDone && status === '–í–∏–∫–æ–Ω–∞–Ω–æ') ? card.classList.add('hidden-task') : card.classList.remove('hidden-task');
      });
    }

    function saveSortSettings() {
      localStorage.setItem('taskSortMode', document.getElementById('sortOrder').value);
    }

    function loadTasks() {
        if (!currentUserEmail) return;

        const ssId = '1v6ZjZqiES45fG35yB3Z17chEoK0df5QSWfMJxOu096A'; 
        const gvizUrl = `https://docs.google.com/spreadsheets/d/${ssId}/gviz/tq?tqx=out:json`;

        fetch(gvizUrl)
          .then(res => res.text())
          .then(data => {
            const json = JSON.parse(data.substring(47, data.length - 2));
            let rows = json.table.rows;
            const list = document.getElementById('taskList');
            document.getElementById('loader').style.display = 'none';
            list.innerHTML = '';

            let tasks = rows.map((row, index) => {
              let rawDate = null;
              // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—É –∫–æ–ª–æ–Ω–∫—É col_DATE
              const dateCell = row.c[col_DATE];
              if (dateCell && dateCell.v) {
                const val = dateCell.v;
                if (typeof val === 'string' && val.includes('Date')) {
                  const parts = val.match(/\d+/g).map(Number);
                  rawDate = new Date(parts[0], parts[1], parts[2]);
                } else {
                  rawDate = new Date(val);
                }
              }

              return {
                row: index + 2,
                title:     (row.c[col_TITLE] && row.c[col_TITLE].v) ? row.c[col_TITLE].v : '',
                priorityDate: rawDate && !isNaN(rawDate) ? rawDate : new Date(2099, 11, 31),
                worker:    (row.c[col_WORKER] && row.c[col_WORKER].v) ? row.c[col_WORKER].v : '',
                status:    (row.c[col_STATUS] && row.c[col_STATUS].v) ? row.c[col_STATUS].v : '',
                userEmail: (row.c[col_TASK_EMAIL] && row.c[col_TASK_EMAIL].v) ? row.c[col_TASK_EMAIL].v : ''
              };
            }).filter(t => t.title && t.userEmail === currentUserEmail);

            // –õ–æ–≥—ñ–∫–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–Ω–¥–µ—Ä—É...
            const sortMode = document.getElementById('sortOrder').value;
            tasks.sort((a, b) => {
              if (a.status === '–í–∏–∫–æ–Ω–∞–Ω–æ' && b.status !== '–í–∏–∫–æ–Ω–∞–Ω–æ') return 1;
              if (a.status !== '–í–∏–∫–æ–Ω–∞–Ω–æ' && b.status === '–í–∏–∫–æ–Ω–∞–Ω–æ') return -1;
              if (sortMode === 'priority') return a.priorityDate - b.priorityDate;
              if (sortMode === 'status') {
                const weights = { "–í –ø—Ä–æ—Ü–µ—Å—ñ": 1, "–ü–∞—É–∑–∞": 2, "–ù–æ–≤–µ": 3, "–í–∏–∫–æ–Ω–∞–Ω–æ": 4 };
                return (weights[a.status] || 99) - (weights[b.status] || 99);
              }
              return a.row - b.row;
            });

            if (tasks.length === 0) {
              list.innerHTML = '<p style="text-align: center; color: #999;">–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å</p>';
            } else {
              tasks.forEach(task => {
                const div = document.createElement('div');
                div.className = 'task-card';
                div.setAttribute('data-status', task.status);
                const dateString = task.priorityDate.getFullYear() === 2099 ? '–Ω–µ –≤–∫–∞–∑–∞–Ω–æ' : task.priorityDate.toLocaleDateString('uk-UA');
                div.innerHTML = `
                  <div class="task-info">
                    <span class="status-badge ${getStatusClass(task.status)}">${task.status}</span><br>
                    <strong>${task.title}</strong>
                    <small>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å: ${task.worker || '–Ω–µ–º–∞—î'}</small>
                    <small style="display: block; margin-top: 4px; color: #7f8c8d; font-weight: 500;">üìÖ –í–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ: ${dateString}</small>
                  </div>
                  <div class="task-controls">
                    <select id="status-${task.row}">
                      <option value="–ù–æ–≤–µ" ${task.status === '–ù–æ–≤–µ' ? 'selected' : ''}>–ù–æ–≤–µ</option>
                      <option value="–í –ø—Ä–æ—Ü–µ—Å—ñ" ${task.status === '–í –ø—Ä–æ—Ü–µ—Å—ñ' ? 'selected' : ''}>–í –ø—Ä–æ—Ü–µ—Å—ñ</option>
                      <option value="–í–∏–∫–æ–Ω–∞–Ω–æ" ${task.status === '–í–∏–∫–æ–Ω–∞–Ω–æ' ? 'selected' : ''}>–í–∏–∫–æ–Ω–∞–Ω–æ</option>
                      <option value="–ü–∞—É–∑–∞" ${task.status === '–ü–∞—É–∑–∞' ? 'selected' : ''}>–ü–∞—É–∑–∞</option>
                      <option value="–í–∏–¥–∞–ª–∏—Ç–∏">–í–∏–¥–∞–ª–∏—Ç–∏</option>
                    </select>
                    <button onclick="updateStatus(${task.row})">–û–Ω–æ–≤–∏—Ç–∏</button>
                  </div>
                `;
                list.appendChild(div);
              });
            }
            applyFilter();
          })
          .catch(err => {
            console.error("–ü–æ–º–∏–ª–∫–∞:", err);
            document.getElementById('loader').innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è";
          });
      }

    function updateStatus(row) {
      const btn = event.target;
      const select = document.getElementById('status-' + row);
      const newStatus = select.value;
      btn.disabled = true;
      btn.innerText = "‚è≥";
      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ row: row, status: newStatus, userEmail: currentUserEmail })
      })
      .then(res => res.json())
      .then(out => {
        if (out.result === "success") { loadTasks(); } 
        else { alert("–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: " + out.message); btn.disabled = false; btn.innerText = "–û–Ω–æ–≤–∏—Ç–∏"; }
      })
      .catch(err => { alert("–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ: " + err); btn.disabled = false; btn.innerText = "–û–Ω–æ–≤–∏—Ç–∏"; });
    }

    function getStatusClass(status) {
      switch(status) {
        case '–ù–æ–≤–µ': return 'status-–Ω–æ–≤–µ';
        case '–í –ø—Ä–æ—Ü–µ—Å—ñ': return 'status-–ø—Ä–æ—Ü–µ—Å—ñ';
        case '–ü–∞—É–∑–∞': return 'status-–ø–∞—É–∑–∞';
        case '–í–∏–∫–æ–Ω–∞–Ω–æ': return 'status-–≤–∏–∫–æ–Ω–∞–Ω–æ';
        default: return '';
      }
    }

    function toggleCreateForm(show) {
      document.getElementById('createForm').style.display = show ? 'block' : 'none';
      if (show) {
        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É —è–∫ –ø—ñ–¥–∫–∞–∑–∫—É
        const today = new Date();
        const day = String(today.getDate()).padStart(2, '0');
        const month = String(today.getMonth() + 1).padStart(2, '0');
        document.getElementById('newDate').value = `${day}.${month}.${today.getFullYear()}`;
        document.getElementById('newTitle').focus();
      }
    }

    function submitNewTask() {
        const title = document.getElementById('newTitle').value.trim();
        const worker = document.getElementById('newWorker').value.trim();
        const date = document.getElementById('newDate').value.trim();
        const btn = document.getElementById('saveTaskBtn');

        // 1. –ë–∞–∑–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
        if (!title || !date) {
          alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –¥–∞—Ç—É");
          return;
        }

        // 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É —Ä–µ–≥—É–ª—è—Ä–Ω–∏–º –≤–∏—Ä–∞–∑–æ–º
        const dateRegex = /^(\d{2})\.(\d{2})\.(\d{4})$/;
        const match = date.match(dateRegex);
        
        if (!match) {
          alert("–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ DD.MM.YYYY (–Ω–∞–ø—Ä. 13.02.2026)");
          return;
        }

        // 3. –õ–æ–≥—ñ—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—Ç–∏ (—á–∏ —ñ—Å–Ω—É—î —Ç–∞–∫–∏–π –¥–µ–Ω—å/–º—ñ—Å—è—Ü—å)
        const day = parseInt(match[1]);
        const month = parseInt(match[2]);
        const year = parseInt(match[3]);
        const testDate = new Date(year, month - 1, day);

        if (testDate.getFullYear() !== year || testDate.getMonth() !== month - 1 || testDate.getDate() !== day) {
          alert("–í–∏ –≤–≤–µ–ª–∏ –Ω–µ—ñ—Å–Ω—É—é—á—É –¥–∞—Ç—É!");
          return;
        }

        // –Ø–∫—â–æ –≤—Å–µ –æ–∫ ‚Äî –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ
        btn.disabled = true;
        btn.innerText = "‚è≥ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...";

        fetch(API_URL + "?action=create", {
          method: "POST",
          body: JSON.stringify({
            title: title,
            worker: worker,
            date: date,
            userEmail: currentUserEmail
          })
        })
        .then(res => res.json())
        .then(out => {
          if (out.result === "success") {
            toggleCreateForm(false);
            document.getElementById('newTitle').value = '';
            document.getElementById('newWorker').value = '';
            loadTasks();
          } else {
            alert("–ü–æ–º–∏–ª–∫–∞: " + out.message);
          }
        })
        .catch(err => alert("–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ: " + err))
        .finally(() => {
          btn.disabled = false;
          btn.innerText = "–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è";
        });
      }

//—Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –º–∞—Å–∫–∏ –¥–∞—Ç–∏
    function formatDateInput(input) {
      // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å–µ, –∫—Ä—ñ–º —Ü–∏—Ñ—Ä
      let value = input.value.replace(/\D/g, '');
      
      // –§–æ—Ä–º—É—î–º–æ —Ä—è–¥–æ–∫ –∑ –∫—Ä–∞–ø–∫–∞–º–∏
      if (value.length > 2 && value.length <= 4) {
        value = value.slice(0, 2) + '.' + value.slice(2);
      } else if (value.length > 4) {
        value = value.slice(0, 2) + '.' + value.slice(2, 4) + '.' + value.slice(4, 8);
      }
      
      input.value = value;
    }
  </script>
</body>
</html>
